<script>
  import { createChart } from "lightweight-charts";
  import { getWeeklyMedianPrices } from "../../services/gcp-services/getAppartmentWeeklyMedianPrices.js";

  let resp = await getWeeklyMedianPrices();

  let data = JSON.parse(resp.body);

  // Get the current users primary locale
  const currentLocale = window.navigator.languages[0];

  // Create a number format using Intl.NumberFormat
  const myPriceFormatter = Intl.NumberFormat(currentLocale, {
    style: "currency",
    currency: "EUR", // Currency for data points
  }).format;

  const chart = createChart(document.getElementById("chart"), {
    layout: {
      backgroundColor: "#860313",
      textColor: "#F48EA3",
    },
    localization: {
      priceFormatter: myPriceFormatter,
    },
    grid: {
      vertLines: {
        visible: false,
      },
      horzLines: {
        color: "#F48EA3",
      },
    },
    rightPriceScale: {
      borderVisible: false,
    },
    timeScale: {
      borderVisible: false,
    },
    crosshair: {
      horzLine: {
        visible: false,
      },
    },
  });

  // Adjust the starting bar width (essentially the horizontal zoom)
  chart.timeScale().applyOptions({
    barSpacing: 20,
  });
  const lineSeries = chart.addLineSeries();
  lineSeries.setData(data);
  lineSeries.applyOptions({
    color: "#eee5f7",
    lineWidth: 2,
  });
</script>

<div class="card-compact card bg-white shadow-xl">
  <div class="card-body m-2 text-mainred">
    <h2 class="card-title">Weekly median appartment prices in vienna</h2>
    <p>
      Crawled directly from appartment listings, twice a week. No filter, just
      the median.
    </p>
    <p>
      For details have a look at <a
        class="text-link"
        href="/dashboards/overview">the project breakdown</a
      >.
    </p>
    <p>This is live data, updated weekly.</p>
  </div>
  <div class="m-2 flex h-60 min-w-fit justify-center rounded-lg bg-snd">
    <div id="chart" class="h-10/12 w-10/12"></div>
  </div>
</div>
